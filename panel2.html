<style>
/* --- REGLAS DE IMPRESIÓN --- */
@media print {
    body > * {
        display: none !important;
    }
    #printable-albaran {
        display: block !important;
        font-family: Arial, sans-serif;
        font-size: 12pt;
        color: black;
    }
    #printable-albaran .details-content {
        padding: 0;
        box-shadow: none;
        border: none;
    }
    #printable-albaran table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    #printable-albaran th, #printable-albaran td {
        border: 1px solid #000;
        padding: 6px;
        text-align: left;
    }
}
</style>

<script>
function populatePrintableAlbaran(order) {
    const printableDiv = document.getElementById('printable-albaran');
    const shippingMethod = order.metodo_de_envio || '';
    let shippingHTML = `<p><strong>Método de Envío:</strong> ${shippingMethod}</p>`;

    if (shippingMethod.toLowerCase().includes('correos')) {
        if (order.para_envios_por_correos_direccion) {
            shippingHTML += `<p><strong>Dirección:</strong> ${order.para_envios_por_correos_direccion}</p>`;
        }
        if (order.codigo_postal_obligatorio_para_envio_correos) {
            shippingHTML += `<p><strong>Código Postal:</strong> ${order.codigo_postal_obligatorio_para_envio_correos}</p>`;
        }
        if (order.poblacion_obligatorio_para_envio_correos_y_inpost) {
            shippingHTML += `<p><strong>Población:</strong> ${order.poblacion_obligatorio_para_envio_correos_y_inpost}</p>`;
        }
        if (order.provincia) {
            shippingHTML += `<p><strong>Provincia:</strong> ${order.provincia}</p>`;
        }
    } 
    else if (shippingMethod.toLowerCase().includes('inpost')) {
        if (order.punto_inpost) {
            shippingHTML += `<p><strong>Punto Inpost:</strong> ${order.punto_inpost}</p>`;
        }
        if (order.poblacion_obligatorio_para_envio_correos_y_inpost) {
            shippingHTML += `<p><strong>Población:</strong> ${order.poblacion_obligatorio_para_envio_correos_y_inpost}</p>`;
        }
    } 
    else if (shippingMethod.toLowerCase().includes('vinted')) {
        if (order.punto_vinted) {
            shippingHTML += `<p><strong>Punto Vinted:</strong> ${order.punto_vinted}</p>`;
        }
    } 

    if (order.numero_de_envio) {
        shippingHTML += `<div class="tracking-number">Nº Envío: ${order.numero_de_envio}</div>`;
    }

    printableDiv.innerHTML = `
        <div class="details-content">
            <div class="details-header">
                <div class="logo">
                    <img src="logo.png" alt="Logo Ana Carolina" class="albaran-logo">
                </div>
                <div class="sender-info">
                    <strong>Pedido #: ${order.rowIndex}</strong><br>
                    Fecha: ${new Date(order.marca_temporal).toLocaleDateString('es-ES')}
                </div>
            </div>
            <div class="details-section">
                <h3>Datos del Cliente</h3>
                <div class="info-block">
                    ${order.nombre_y_apellido ? `<p><strong>Nombre:</strong> ${order.nombre_y_apellido}</p>` : ""}
                    ${order.correo_electronico_obligatorio_para_envios_correos_y_inpost ? `<p><strong>Email:</strong> ${order.correo_electronico_obligatorio_para_envios_correos_y_inpost}</p>` : ""}
                    ${order.telefono_obligatorio_para_envio_correos_y_inpost || order.telefono_698982882 ? `<p><strong>Teléfono:</strong> ${order.telefono_obligatorio_para_envio_correos_y_inpost || order.telefono_698982882}</p>` : ""}
                </div>
            </div>
            <div class="details-section">
                <h3>Detalles del Libro y Firma</h3>
                <div class="info-block">
                    ${order.quieres_firmado ? `<p><strong>¿Quiere el libro firmado?:</strong> ${order.quieres_firmado}</p>` : ""}
                    ${order.nombre_para_la_firma ? `<p><strong>Nombre para la dedicatoria:</strong> ${order.nombre_para_la_firma}</p>` : ""}
                </div>
            </div>
            <div class="details-section">
                <h3>Producto</h3>
                <table class="albaran-table">
                    <thead>
                        <tr>
                            <th>Descripción</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Libro "YO ANTES Y DESPUÉS DE TI"</td>
                            <td>1</td>
                            <td>24 €</td>
                            <td>24 €</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="details-section">
                <h3>Información de Envío</h3>
                <div class="info-block">${shippingHTML}</div>
            </div>
        </div>
    `;
}
</script>

