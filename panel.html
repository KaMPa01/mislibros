<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Gestión de Pedidos</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        /* Estilos del Login */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f4f7f9; display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .login-box { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; width: 300px; }
        .login-box h2 { margin-top: 0; }
        .login-box input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .login-box button { width: 100%; background-color: #3498db; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-size: 1em; }
        .login-box button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #login-error { color: #e74c3c; margin-top: 10px; display: none; }
        
        /* Estilos del Panel Principal */
        #main-content { display: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1, h2, h3 { color: #2c3e50; }
        
        /* Estilos para el Menú Lateral */
        .main-layout { display: flex; flex-direction: row; gap: 30px; }
        #orders-container { flex-grow: 1; }
        #filter-menu { flex-basis: 220px; flex-shrink: 0; background-color: #ffffff; border-radius: 8px; padding: 20px; height: fit-content; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        #filter-menu h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        #filter-menu ul { list-style: none; padding: 0; margin: 0; }
        #filter-menu li a { display: block; padding: 10px 15px; text-decoration: none; color: #34495e; border-radius: 5px; transition: background-color 0.2s; }
        #filter-menu li a:hover { background-color: #f2f2f2; }
        #filter-menu li a.active { background-color: #3498db; color: white; font-weight: bold; }

        .loading { text-align: center; padding: 50px; font-size: 1.2em; }
        .order-list { list-style: none; padding: 0; }
        .order-item { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: box-shadow 0.2s; }
        .order-item:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .order-item.status-enviado { background-color: #e8f5e9; border-left: 5px solid #4CAF50; }
        .order-details { flex-grow: 1; }
        .order-details strong { font-size: 1.1em; }
        .order-actions button { background-color: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }

        /* Estilos de la Ventana de Detalles */
        .details-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: flex-start; z-index: 1000; overflow-y: auto; padding: 40px 20px; box-sizing: border-box; }
        .details-content { background: white; padding: 40px; width: 100%; max-width: 800px; box-shadow: 0 0 20px rgba(0,0,0,0.2); border-radius: 8px; }
        .details-header { display: flex; justify-content: space-between; border-bottom: 2px solid #ccc; padding-bottom: 20px; align-items: flex-start; }
        .albaran-logo { max-width: 150px; max-height: 70px; object-fit: cover; border-radius: 4px; }
        .details-header .sender-info { text-align: right; }
        .details-section { margin-top: 30px; }
        .details-section .info-block { background: #f9f9f9; padding: 15px; border-radius: 5px; margin-top: 10px; }
        .info-block p { margin: 5px 0; }
        .bizum-link a { font-weight: bold; color: #16a085; text-decoration: none; }
        .albaran-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .albaran-table th, .albaran-table td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        .albaran-table th { background-color: #f2f2f2; }
        .details-controls { text-align: center; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .details-controls button { background-color: #2ecc71; color: white; padding: 12px 20px; font-size: 1em; margin: 5px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        .details-controls .close-btn { background-color: #e74c3c; }
        .tracking-number { background-color: #eaf2f8; border-left: 4px solid #3498db; padding: 10px; margin-top: 10px; font-weight: bold;}
        
        /* Estilos para Gemini */
        .gemini-assistant { border: 2px dashed #a5b4fc; padding: 20px; border-radius: 8px; margin-top: 10px; }
        .gemini-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 15px; font-size: 0.9em; border-radius: 5px; cursor: pointer; margin-right: 10px; }
        .gemini-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        #gemini-result-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 2500; }
        .gemini-result-box { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 600px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .gemini-result-box h3 { margin-top: 0; }
        #gemini-result-textarea { width: 100%; height: 200px; margin-top: 15px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-family: inherit; box-sizing: border-box; }
        .gemini-result-controls { margin-top: 15px; text-align: right; }
        .gemini-result-controls button { margin-left: 10px; }

        /* Estilos para la Ventana de Confirmación y Prompt */
        .dialog-box { background: white; padding: 30px; border-radius: 8px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .dialog-controls { margin-top: 20px; }
        .dialog-controls button { padding: 10px 20px; font-size: 1em; }
        #prompt-input { width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }

        @media (max-width: 900px) { .main-layout { flex-direction: column-reverse; } }
        /* REGLAS DE IMPRESIÓN MEJORADAS */
        @media print { 
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            body * { visibility: hidden; } 
            .details-overlay, .details-content, .details-content * { visibility: visible; } 
            .details-overlay { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: none; padding: 0; } 
            .details-content { width: 210mm; height: 297mm; box-shadow: none; margin: 0; border-radius: 0; box-sizing: border-box; } 
            .details-controls, .gemini-assistant, .payment-proof-section { display: none; } 
        }
    </style>
</head>
<body>
    <div id="login-overlay">
        <div class="login-box"><h2>Acceso al Panel</h2><p>Introduce tus credenciales</p><input type="text" id="username" placeholder="Usuario" required><input type="password" id="password" placeholder="Contraseña" required><button id="login-btn">Entrar</button><p id="login-error">Usuario o contraseña incorrectos.</p></div>
    </div>
    <div id="main-content">
        <div class="container">
            <div class="main-layout">
                <div id="orders-container">
                    <h1>Panel de Pedidos</h1>
                    <p>Aquí se muestran los pedidos recibidos desde el formulario de preventa.</p>
                    <div id="loader" class="loading">Cargando pedidos...</div>
                    <ul id="order-list" class="order-list"></ul>
                </div>
                <aside id="filter-menu">
                    <h3>Filtrar Pedidos</h3>
                    <ul>
                        <li><a href="#" class="filter-btn active" data-filter="todos">Todos</a></li>
                        <li><a href="#" class="filter-btn" data-filter="pendiente">No Enviados</a></li>
                        <li><a href="#" class="filter-btn" data-filter="enviado">Enviados</a></li>
                    </ul>
                </aside>
            </div>
        </div>
        <div id="details-overlay" class="details-overlay">
            <div id="details-content" class="details-content">
                <div class="details-header">
                    <div class="logo">
                        <!-- ▼▼▼ LOGO ACTUALIZADO ▼▼▼ -->
                        <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/2wBDAAYEBAUEBAYFBQUGBgYHCQ4JCQgICRINDQoOFRIWFhUSFBQXGIcHBxQfHh0iJCUnJjYrHicqKiooJDs2OTY3ODk6MP/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAA7AKADASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECA//EABwQAQEBAAIDAQEAAAAAAAAAAAABEQISAyExQf/EABgBAQEBAQEAAAAAAAAAAAAAAAABAgME/8QAHBEBAQEAAwEBAQEAAAAAAAAAAAERAgMhMRIT/9oADAMBAAIRAxEAPwD2UA0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL-OT/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz/A/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz/8QAFwEBAQEBAAAAAAAAAAAAAAAAAAECA//EABwRAQEBAAIDAQEAAAAAAAAAAAABEQISAyExQf/EABgBAQEBAQEAAAAAAAAAAAAAAAABAgME/8QAHBEBAQEAAwEBAQEAAAAAAAAAAAERAgMhMRIT/9oADAMBAAIRAxEAPwD2UA0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0yAAqgCoAKgAqAAqgCoAKgIqAAqAAqAAqgCoAKgAqAAqAAqgL0A0-OT/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-iVBORw0KGgoAAAANSUhEUgAAAKAAAABaCAYAAAD1c36bAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAP+lSURBVHhe3P1ZlFzF1a7l57z/43/m/33+V1W//21WVa9XU1VXV7d6vWq99/b63t63mN3Z9/b2vT1t4/c/f7v/834sO2iCIiIgIggICqJgQcM9BQUBBxRQQAQEBEEkY/gN8d3/o8yDDBj36NGjN/jB0SNHN/jB/6bY783s7Nn2x2fGjBn2vTljxozd7zljxoy3e+9/o0aNMmvMvP71r29d6lKXRjH7b1f3b392xRdfjP/5X/+32e3N3//+97e+853vDGL/2x85cuSgA7j+yJkzZ3x+350/f/57v/d7f+yA3h85d+7clVdeee1d99wz61JXx877f3/j/p2t8847d//3f//f2e3Nf/qnP73pTW9606hR0d+nRo0aNaofR40a9a/e7N/T2/974+7d2x/v3Llz4+9+97vbn/v2979P02N/s/1r1659+umnn33oQx96+umnv//ss8+OP/vss/H3vvfeh975znd+7+GHH/7eL7300veef/757/3qq6/e+3u//vVXv/f9999vBvL+jRs3btu2rU/aE/Tf//3f7733vvfed99991N+D2wNGrXjQzVq1b4Gv7b727dv37Zt2wP7+41vfOOgg+w+gP3+x/5+/+tf/zp06NDbbruN2/3eP/nkk88///yn/J/3/9FHH73xW6+88sovvfTS5/177rln+D9y6dKlS5cuPfPMMx955JGRI0cOHDhQGq5evfroo48++eST/Xv6X/+N+3e2hRdeOKa3Vf96NGrVvi5Uv7+N99y3b9+2efNms9ub/fbb78bN/s3+vXfNnz/fePzxx++6664H/wH8gB40aFB2dva3v/3tf/u3f/u+++67999///bt2/fv399o9urVq4ceeuhtt902cuTIoUOHeu/wW61atXv37t9//309f3j06NEbbrih1+0Vq1YNf/mXf/nqq68+8MADt9xyy6effvrRRx89e/bs0KFDx40bd/bZZ3/jG9+4efNmA/Dtt99+7LHHjjnmGLfb+82bN/fs2bNp0yYDM2PGjL17927evHlW9GfQoEGDBv37oEGDBr+n/Y2bN2++4447nn/++ddcc038ve+++x79+vUbe4vffPNNA7D33nvvv//+24gRI7Zt27Z169ZXX3313HPPfeyxxz700EO/+c1vpk2bdvLJJ5933nlFixatVq1ad999t3v37v/3f/+31+0ZMGDAgAED+n0dOnTo5JNPPrH/zTvvvPOII47Ydddd+33gM2jQ4K/j6NGj53e7X331Vff67pAhQ3bv3t08/I/8PqBHH330oYceunbt2rFjx95zzz3fffddr/9HDBgwYMGCBXPnzs3/oEGDBg36B/T++fPnD/sP/oAGDBjw12L/5cceeywfY/aX/+vnnnusP+Z9f7Dfv/89bNiwf/zjH2+66abaD373a6+9dvjw4U8++eTtt99+5ZVX/vIv//K3vvWtb3nLW+677z7/9V//tVb9+iN+/PFHffL/c+fOPeGEE+wN840dOzYA25H6/Y/V2y9evDgb2w3l+4/+9s1vf7P3zSeffPKhhx5qP/iVv/zlL3/lK1/5gAc8wH781VdeeWWeeef9//TTT69evXrmmWeOHTt2+vTpr7zyyr59+yq/oEFf0K9u/506derQoUO//vWv79mzJ2+99dbll18+8sgjb7311m233VYDMPt277zzzmOPPTbn/3PPPdfu9v7SpUuXLVv2oAc96IMf/OC3vOUtv/M7v+ODXjR+5JFHjj/++Hnz5r3//vvZ2dmDDz74xRdfvOaaa15//fW33357y5Yt//M///Okk05as2ZNNYn51R/F/nL//n0HsP+uW7duhYp1WvPee++t/O/n4P/b999/P/DAAwcPHjz//PNz587t1atX9v+W7N+/P+/evbv99ttvsccee+aZZx599NG/+Mu/tB/v/Z07d2Yn/R/8P/zYv/1v+zN++OGH8z+w/8D/+663v/vd7zZt2hRz0K9h/59//vnG/TsrVqwojM9V/3v/2x/u//rXv5577rn79+9/4xvf+Je//OUhhxxyww03vPjii+vXr29nZzdv3vzsZz978803135/l7sPfOADd91118iRI3/lK1+ZNWvWggsuOH78+OXLly9dujRr1qxZs2b/0i/90je96U3Dhg079dRTn/jEJ6xevbp+/fru27dv27ZtVVRGozTqV7f+fv3rv9GgQYMG/Xt/e/WvH+a6125c/fH48ePf//73z/7e0KBBgwbtqVevXr169U+bNm3vv/9e73O/LFiw4IMPPujp8W9o0KBBg/59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73/pP//9P9f/Wf6N+1d+oRq3+Uf+v3r2jRvVv+zP7693/13+rUr1adWv9/+H+1V+/f6v+tWvVv3+NGjWof+z9/y39f2tUv16/Ro1avWpU/9Kj+lf/3j9r1P9S/9anRq1qf9n+H2rV6l+pX/07Nav+v0aN6l+p/f8oU43+qf1/jRq/ql/t+kft+nf+n6P++h90/9b/3n96fPrX/+b1T/W/9+o9q3RoP6t/t+0v4f6R+v/n/S+v/6NGr96/6R6tRvT/1D/p/16/ePfq1atWvfqvW7e13qf6H3T/Vv9W/1r/Vv+oP7T+rd792vWv3n/Uv/p/p/W/Uf16/1H/+p/W/o/W/+P+V/s/WP/H+r/0/7dGrd7v+l+9evWv/3ftXv/G/fvU7f+9evXv2r36V//Xv/qvUr9/+T3d+z/SP/6d+oD9r+l+/X92/o+1+9e/+6vUr/96v2oD9t++vdr969+//r/1r9+vfv3//WvfrUr07/Vq0D/qP6N2r3b96z+r969+//rVr369evXr36v/16/f/3p9+/fr/1L7/+r/3P6n9n9p/xP0P6P/j/3/0/1P7f7Ur+rfr/5H/+v/0P/f+j+j9W/Vv9W9evXr/1P7f/l/+n/s/w/0D/wP6/V/6X/v36l+9frX6f7lf/Vv/av/o36l+oP7P/F+/c/q/+P/Z/o/aN+/+oD9f+j/L/yP/o/f/9X/x/+D/b+1+tfr369+vftfvXv2r3/9P/169+vfrX79+9fr3v1L7/yD3D/1//x/7v9X//f1/63/y//f+p/Z/6n9f+r/2P2v1/+H/3/y/6f/j/4/7X/p/qf2f2P/b/0//P/B/8P+v/z/6H9v/D/j/+n/V//p/9X/a/u/+n+p/d/S/z/0f/r/2/8v/3/p/6P/g/6/+n/w/7X7X/f/p/2P2P+n/y/1H/H/t/9P/p/6v/1/9H/h/y/o/+v/V/f/qf2f+H/7/1P7P/r/8f8v/X/p/4v/b/r/8P+X/Z/v/0v/P/J/6f9v/d/+/y/+v/2//n/9/+j+x/+f+r/H/L/o/+f+l+1+tftftfuX+r+1+1++/+X+1+r/x/9v/V/+P/h/y/6f+v/qf2f2v2v/P/Q//95f/J/2v2v3L/V//9+h//P2f/Z/f/q/1//H/b/2//j/4f6v9H/t/r/wv5f+v/B/9/9H/3/9/9n/9/o/6/8H/3/qf+v/d/+v7v9v/B/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//AP+/AP//AP9/AP9fAP//AP+/AP9/AP+/AP9fAf9fAP9fAP9/AP9fAv9fAP9fAP9fAP9fAP9fAv9fAP9fAP9fAP9fAP9fAP9fAP9fAP9fAP9fAP9fAP9fAP9fAP//Af//AP+/AP9/Af//Af//AP//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//AP//AP//Af//AP//Af//Af//Af//AP//Af//AP//Af//AP//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af//Af-E1/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzj/etc/etc" alt="Logo Ana Carolina" class="albaran-logo">
                    </div>
                    <div class="sender-info"><strong>Pedido #: <span id="details-order-id"></span></strong><br>Fecha: <span id="details-date"></span></div>
                </div>

                <div class="details-section">
                    <h3>Datos del Cliente</h3>
                    <div class="info-block"><p><strong>Nombre:</strong> <span id="details-name"></span></p><p><strong>Email:</strong> <span id="details-email"></span></p><p><strong>Teléfono:</strong> <span id="details-phone"></span></p></div>
                </div>
                <div class="details-section">
                    <h3>Detalles del Libro y Firma</h3>
                    <div class="info-block"><p><strong>¿Quiere el libro firmado?:</strong> <span id="details-signed"></span></p><p><strong>Nombre para la dedicatoria:</strong> <span id="details-dedication"></span></p></div>
                </div>
                <div class="details-section">
                    <h3>Producto</h3>
                    <table class="albaran-table">
                        <thead><tr><th>Descripción</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th></tr></thead>
                        <tbody><tr><td>Libro "YO ANTES Y DESPUÉS DE TI"</td><td>1</td><td>24 €</td><td>24 €</td></tr></tbody>
                    </table>
                </div>
                <div class="details-section">
                    <h3>Información de Envío</h3>
                    <div id="shipping-info-block" class="info-block"></div>
                </div>

                <div class="details-section payment-proof-section">
                    <h3>Justificante de Pago (Bizum)</h3>
                    <div class="info-block bizum-link">
                        <p><a id="details-payment-proof" href="#" target="_blank" rel="noopener noreferrer">VER JUSTIFICANTE DE PAGO</a></p>
                    </div>
                </div>

                <div class="details-section">
                    <h3>Asistente Mágico</h3>
                    <div class="info-block gemini-assistant">
                        <button id="gemini-dedication-btn" class="gemini-btn" disabled>✨ Sugerir Dedicatoria</button>
                        <button id="gemini-email-btn" class="gemini-btn" disabled>✨ Redactar Email de Envío</button>
                    </div>
                </div>

                <div id="details-controls" class="details-controls">
                    <button id="print-btn">Imprimir / Guardar PDF</button>
                    <button id="mark-sent-btn">Marcar como Enviado</button>
                    <button id="close-btn" class="close-btn">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="gemini-result-overlay">
        <div class="gemini-result-box">
            <h3 id="gemini-result-title">Sugerencia Mágica</h3>
            <textarea id="gemini-result-textarea" readonly></textarea>
            <div class="gemini-result-controls">
                <button id="gemini-copy-btn" class="order-actions-button">Copiar Texto</button>
                <button id="gemini-close-btn" class="details-controls-button close-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="confirm-overlay" class="details-overlay" style="z-index: 3000; display: none;">
        <div class="dialog-box">
            <h3 id="confirm-title">¿Estás seguro?</h3>
            <p id="confirm-text">Esta acción no se puede deshacer.</p>
            <div class="dialog-controls">
                <button id="confirm-yes-btn">Sí, continuar</button>
                <button id="confirm-no-btn" class="close-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="prompt-overlay" class="details-overlay" style="z-index: 3000; display: none;">
        <div class="dialog-box">
            <h3 id="prompt-title">Introduce el dato</h3>
            <p id="prompt-text">Por favor, introduce la información solicitada.</p>
            <input type="text" id="prompt-input">
            <div class="dialog-controls">
                <button id="prompt-ok-btn">Aceptar</button>
                <button id="prompt-cancel-btn" class="close-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwq2sZzesRJaILN0_FemOoVNA9s4CsWNjNaEyYtFs1_GS5sS8_9cCjiItC6YSqUt1et/exec";

        // --- SECCIÓN DE LOGIN ---
        const loginOverlay = document.getElementById('login-overlay');
        const mainContent = document.getElementById('main-content');
        const loginBtn = document.getElementById('login-btn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('login-error');
        loginBtn.addEventListener('click', attemptLogin);
        passwordInput.addEventListener('keypress', (e) => e.key === 'Enter' && attemptLogin());
        
        function attemptLogin() {
            loginBtn.disabled = true; loginBtn.textContent = 'Verificando...'; loginError.style.display = 'none';
            const payload = { action: 'login', user: usernameInput.value, pass: passwordInput.value };
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
            .then(response => response.json()).then(data => {
                if (data.success) { loginOverlay.style.display = 'none'; mainContent.style.display = 'block'; loadOrders(); } 
                else { loginError.textContent = 'Usuario o contraseña incorrectos.'; loginError.style.display = 'block'; loginBtn.disabled = false; loginBtn.textContent = 'Entrar'; }
            }).catch(error => { console.error('Error en el login:', error); loginError.textContent = 'Error de conexión. Revisa la URL y la implementación del script.'; loginError.style.display = 'block'; loginBtn.disabled = false; loginBtn.textContent = 'Entrar'; });
        }

        // --- SECCIÓN DE LA APP DE PEDIDOS ---
        const loader = document.getElementById('loader');
        const orderList = document.getElementById('order-list');
        const detailsOverlay = document.getElementById('details-overlay');
        let allOrders = []; 
        let currentOrderElement = null;
        let currentOpenOrder = null; // Variable para guardar el pedido abierto

        const geminiResultOverlay = document.getElementById('gemini-result-overlay');
        const geminiResultTitle = document.getElementById('gemini-result-title');
        const geminiResultTextarea = document.getElementById('gemini-result-textarea');
        const geminiCopyBtn = document.getElementById('gemini-copy-btn');
        const geminiCloseBtn = document.getElementById('gemini-close-btn');

        async function callGemini(prompt, title) {
            geminiResultTitle.textContent = title;
            geminiResultTextarea.value = "Generando respuesta...";
            geminiResultOverlay.style.display = 'flex';
            const apiKey = ""; 
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { throw new Error(`Error en la API: ${response.statusText}`); }
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                geminiResultTextarea.value = text || "No se pudo generar una respuesta. Inténtalo de nuevo.";
            } catch (error) {
                console.error("Error llamando a Gemini:", error);
                geminiResultTextarea.value = `Error de conexión con el asistente. Detalles: ${error.message}`;
            }
        }

        geminiCopyBtn.addEventListener('click', () => {
            geminiResultTextarea.select();
            document.execCommand('copy');
            geminiCopyBtn.textContent = '¡Copiado!';
            setTimeout(() => { geminiCopyBtn.textContent = 'Copiar Texto'; }, 2000);
        });
        geminiCloseBtn.addEventListener('click', () => geminiResultOverlay.style.display = 'none');
        
        function showConfirm(title, text) {
            return new Promise((resolve) => {
                const confirmOverlay = document.getElementById('confirm-overlay');
                document.getElementById('confirm-title').textContent = title;
                document.getElementById('confirm-text').textContent = text;
                confirmOverlay.style.display = 'flex';
                const yesBtn = document.getElementById('confirm-yes-btn');
                const noBtn = document.getElementById('confirm-no-btn');
                const cleanup = () => { yesBtn.removeEventListener('click', yesListener); noBtn.removeEventListener('click', noListener); };
                const yesListener = () => { confirmOverlay.style.display = 'none'; cleanup(); resolve(true); };
                const noListener = () => { confirmOverlay.style.display = 'none'; cleanup(); resolve(false); };
                yesBtn.addEventListener('click', yesListener, { once: true });
                noBtn.addEventListener('click', noListener, { once: true });
            });
        }

        function showPrompt(title, text, defaultValue = "") {
            return new Promise((resolve) => {
                const promptOverlay = document.getElementById('prompt-overlay');
                document.getElementById('prompt-title').textContent = title;
                document.getElementById('prompt-text').textContent = text;
                const input = document.getElementById('prompt-input');
                input.value = defaultValue;
                promptOverlay.style.display = 'flex';
                input.focus();
                const okBtn = document.getElementById('prompt-ok-btn');
                const cancelBtn = document.getElementById('prompt-cancel-btn');
                const cleanup = () => { okBtn.removeEventListener('click', okListener); cancelBtn.removeEventListener('click', cancelListener); input.removeEventListener('keypress', enterListener); };
                const okListener = () => { promptOverlay.style.display = 'none'; cleanup(); resolve(input.value); };
                const cancelListener = () => { promptOverlay.style.display = 'none'; cleanup(); resolve(null); };
                const enterListener = (e) => { if (e.key === 'Enter') { okListener(); } };
                okBtn.addEventListener('click', okListener, { once: true });
                cancelBtn.addEventListener('click', cancelListener, { once: true });
                input.addEventListener('keypress', enterListener);
            });
        }

        function loadOrders() {
            loader.style.display = 'block';
            orderList.innerHTML = '';
            fetch(SCRIPT_URL).then(response => response.json()).then(data => {
                loader.style.display = 'none';
                allOrders = data;
                filterOrders(document.querySelector('.filter-btn.active').dataset.filter);
            }).catch(error => { loader.textContent = "Error al cargar los pedidos."; console.error('Error fetching orders:', error); });
        }

        function filterOrders(filter) {
            let filteredOrders;
            if (filter === 'todos') { filteredOrders = allOrders; } 
            else if (filter === 'enviado') { filteredOrders = allOrders.filter(order => order.estado && order.estado.trim().toLowerCase() === 'enviado'); } 
            else { filteredOrders = allOrders.filter(order => !order.estado || order.estado.trim().toLowerCase() !== 'enviado'); }
            renderOrders(filteredOrders);
        }

        function renderOrders(orders) {
            orderList.innerHTML = '';
            if (orders.length === 0) { orderList.innerHTML = '<p style="text-align: center; color: #777;">No hay pedidos en esta categoría.</p>'; }
            orders.forEach(order => {
                if (!order.marca_temporal) return; 
                const li = document.createElement('li');
                li.className = 'order-item';
                if (order.estado && order.estado.trim().toLowerCase() === 'enviado') li.classList.add('status-enviado');
                li.innerHTML = `
                    <div class="order-details">
                        <strong>${order.nombre_y_apellido || 'Sin nombre'}</strong> - ${order.metodo_de_envio || 'Sin método envío'}<br>
                        <small>Pedido el: ${new Date(order.marca_temporal).toLocaleString('es-ES')}</small>
                    </div>
                    <div class="order-actions"><button>Ver Detalles</button></div>`;
                orderList.appendChild(li);
                li.querySelector('button').addEventListener('click', (e) => {
                    currentOrderElement = e.target.closest('.order-item');
                    showOrderDetails(order);
                });
            });
        }

        function showOrderDetails(order) {
            currentOpenOrder = order;
            document.getElementById('details-order-id').textContent = order.rowIndex;
            document.getElementById('details-date').textContent = new Date(order.marca_temporal).toLocaleDateString('es-ES');
            document.getElementById('details-name').textContent = order.nombre_y_apellido || 'No especificado';
            document.getElementById('details-email').textContent = order.correo_electronico_obligatorio_para_envios_correos_y_inpost || 'No especificado';
            document.getElementById('details-phone').textContent = order.telefono_obligatorio_para_envio_correos_y_inpost || order.telefono_698982882 || 'No especificado';
            document.getElementById('details-signed').textContent = order.quieres_firmado || 'No especificado';
            document.getElementById('details-dedication').textContent = order.nombre_para_la_firma || 'No aplica';
            
            const shippingBlock = document.getElementById('shipping-info-block');
            const shippingMethod = order.metodo_de_envio || '';
            let shippingHTML = `<p><strong>Método de Envío:</strong> ${shippingMethod}</p>`;
            if (shippingMethod.toLowerCase().includes('correos')) { 
                shippingHTML += `
                    <p><strong>Dirección:</strong> ${order.para_envios_por_correos_direccion || 'No especificado'}</p>
                    <p><strong>Código Postal:</strong> ${order.codigo_postal_obligatorio_para_envio_correos || 'No especificado'}</p>
                    <p><strong>Población:</strong> ${order.poblacion_obligatorio_para_envio_correos_y_inpost || 'No especificado'}</p>
                    <p><strong>Provincia:</strong> ${order.provincia || 'No especificado'}</p>
                `;
            } 
            else if (shippingMethod.toLowerCase().includes('inpost')) { shippingHTML += `<p><strong>Punto Inpost:</strong> ${order.punto_inpost || 'No especificado'}</p><p><strong>Población:</strong> ${order.poblacion_obligatorio_para_envio_correos_y_inpost || 'No especificado'}</p>`; } 
            else if (shippingMethod.toLowerCase().includes('vinted')) { shippingHTML += `<p><strong>Punto Vinted:</strong> ${order.punto_vinted || 'No especificado'}</p>`; } 
            else { shippingHTML += `<p>No se ha especificado una dirección válida para este método.</p>`; }
            if (order.numero_de_envio) { shippingHTML += `<div class="tracking-number">Nº Envío: ${order.numero_de_envio}</div>`; }
            shippingBlock.innerHTML = shippingHTML;

            const paymentLink = document.getElementById('details-payment-proof');
            const paymentSection = document.querySelector('.payment-proof-section');
            const proofUrl = order.pago_mediante_bizum_y_justificante_de_pago_telefono_698982882 || '';
            if (proofUrl) {
                paymentLink.href = proofUrl;
                paymentSection.style.display = 'block';
            } else {
                paymentLink.href = '#';
                paymentSection.style.display = 'none';
            }
            
            const markSentBtn = document.getElementById('mark-sent-btn');
            markSentBtn.dataset.rowIndex = order.rowIndex;
            const currentState = (order.estado || 'Pendiente').trim().toLowerCase();
            markSentBtn.dataset.currentState = currentState;
            if (currentState === 'enviado') { markSentBtn.textContent = 'Desmarcar Envío'; markSentBtn.style.backgroundColor = '#f39c12'; } 
            else { markSentBtn.textContent = 'Marcar como Enviado'; markSentBtn.style.backgroundColor = '#2ecc71'; }

            const dedicationBtn = document.getElementById('gemini-dedication-btn');
            const emailBtn = document.getElementById('gemini-email-btn');
            const bookTitle = 'YO ANTES Y DESPUÉS DE TI';
            const dedicationName = order.nombre_para_la_firma;
            if (dedicationName && dedicationName.trim() !== '') {
                dedicationBtn.disabled = false;
                dedicationBtn.onclick = () => {
                    const prompt = `Actúa como la autora de romance erótico Ana Carolina. Escribe 3 opciones de dedicatorias cortas, cálidas y personales para mi libro "${bookTitle}", dedicadas a un lector llamado "${dedicationName}". El tono debe ser cercano y agradecido.`;
                    callGemini(prompt, 'Sugerencias de Dedicatoria');
                };
            } else {
                dedicationBtn.disabled = true;
                dedicationBtn.onclick = null;
            }
            const trackingNumber = order.numero_de_envio;
            if (currentState === 'enviado' && trackingNumber) {
                emailBtn.disabled = false;
                emailBtn.onclick = () => {
                    const customerName = order.nombre_y_apellido;
                    const prompt = `Redacta un email corto, informal y amigable en español para un cliente llamado "${customerName}". El propósito es notificarle que su libro "${bookTitle}" ha sido enviado. Menciona que su número de seguimiento con ${shippingMethod} es ${trackingNumber}. Agradece su apoyo y firma como "Ana Carolina".`;
                    callGemini(prompt, 'Borrador de Email de Envío');
                };
            } else {
                emailBtn.disabled = true;
                emailBtn.onclick = null;
            }

            detailsOverlay.style.display = 'flex';
        }
        
        document.getElementById('print-btn').addEventListener('click', () => window.print());
        document.getElementById('close-btn').addEventListener('click', () => detailsOverlay.style.display = 'none');
        
        document.getElementById('mark-sent-btn').addEventListener('click', async (e) => {
            const button = e.target;
            const rowIndex = button.dataset.rowIndex;
            const currentState = button.dataset.currentState;
            let payload;
            
            if (currentState === 'enviado') {
                const confirmed = await showConfirm("Confirmar Acción", "Se borrará el número de seguimiento. ¿Estás seguro de que quieres desmarcar este pedido?");
                if (confirmed) {
                    payload = { action: 'updateStatus', rowIndex: rowIndex, status: 'Pendiente', tracking: '', sendEmail: false };
                } else { return; }
            } else {
                const trackingNumber = await showPrompt("Marcar como Enviado", "Introduce el número de envío/seguimiento:");
                if (trackingNumber === null) { return; }
                const sendEmailConfirmed = await showConfirm("Enviar Email", "¿Quieres enviar un email de notificación al cliente?");
                
                payload = { 
                    action: 'updateStatus', 
                    rowIndex: rowIndex, 
                    status: 'Enviado', 
                    tracking: trackingNumber,
                    sendEmail: sendEmailConfirmed,
                    orderData: { // Enviamos los datos necesarios para el email
                        customerName: currentOpenOrder.nombre_y_apellido,
                        customerEmail: currentOpenOrder.correo_electronico_obligatorio_para_envios_correos_y_inpost,
                        bookTitle: 'YO ANTES Y DESPUÉS DE TI',
                        shippingMethod: currentOpenOrder.metodo_de_envio,
                        trackingNumber: trackingNumber
                    }
                };
            }

            button.disabled = true; button.textContent = 'Actualizando...';
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
            .then(response => response.json()).then(result => {
                if (result.success) { alert('¡Estado del pedido actualizado!'); detailsOverlay.style.display = 'none'; loadOrders(); } 
                else { alert('Error al actualizar: ' + result.message); }
                button.disabled = false;
            }).catch(error => { console.error('Error updating status:', error); alert('Error de conexión.'); button.disabled = false; });
        });

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelector('.filter-btn.active').classList.remove('active');
                e.target.classList.add('active');
                filterOrders(e.target.dataset.filter);
            });
        });
    </script>
</body>
</html>










